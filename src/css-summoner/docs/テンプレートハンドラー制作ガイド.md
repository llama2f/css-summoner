# CSS Builder ハンドラー開発ガイド 

このドキュメントでは、CSS Builder にコンポーネントハンドラーを追加する方法について説明します。ハンドラーは、選択されたコンポーネントタイプに基づいてプレビュー用のReact要素を生成し、それから自動的にコード表示用のHTML文字列を生成する役割を担います。

## 目次

1.  [ハンドラーの基本概念](#ハンドラーの基本概念)
2.  [ハンドラーファイルの作成](#ハンドラーファイルの作成)
3.  [自動登録の仕組み](#自動登録の仕組み)
4.  [ハンドラーの実装詳細](#ハンドラーの実装詳細)
5.  [JSXからHTMLの自動生成](#jsxからhtmlの自動生成)
6.  [ベストプラクティス](#ベストプラクティス)
7.  [デバッグ](#デバッグ)

## ハンドラーの基本概念

CSS Builder  では、コンポーネントタイプごとにハンドラーモジュールを作成します。これらのモジュールはビルド時に自動的に検出・登録され、実行時に非同期で読み込まれて使用されます。

### ハンドラーの役割

-   プレビュー表示用の **React要素 (`reactElement`)** を生成する。
-   コード表示用の **HTML文字列 (`htmlString`)** は **JSXから自動生成** される。
-   ユーザーがUIで選択したクラス（バリアント、サイズ、色、モディファイアなど）を反映する。

### ハンドラーモジュールの基本構造

ハンドラーは、特定の形式でエクスポートを持つ `.jsx` ファイルとして作成します。

```jsx
// src/css-summoner/templates/handlers/auto/example.jsx
import React from 'react';
import { createHandlerResult, separateProps, sampleIcon } from '../common'; // 共通ユーティリティ

// 1. メタデータ (必須)
export const metadata = {
  type: 'example', // コンポーネントタイプ (必須・一意)
  category: 'general', // カテゴリ (任意)
  description: 'ハンドラーの例', // 説明 (任意)
};

// 2. 基本レンダラー (render または variants のどちらか一方は必須)
export function render(props) {
  // プロパティを分離
  const { reactProps, domProps, commonProps } = separateProps(
    props,
    ['classString', 'children'], // React特有のプロパティ
    ['id', 'role'] // DOM要素に直接渡すプロパティ
  );
  
  // 各種プロパティの取得
  const { classString = '', children = 'Example Content' } = reactProps;
  const { id, role } = domProps;

  // ReactElementの生成
  const reactElement = (
    <div 
      className={classString}
      id={id}
      role={role}
      {...commonProps}
    >
      {children}
    </div>
  );
  
  // createHandlerResultでReactElementからHTMLを自動生成
  return createHandlerResult(reactElement);
}

// 3. バリアント固有レンダラー (オプション)
export const variants = {
  special: (props) => {
    // プロパティを分離
    const { reactProps, domProps, commonProps } = separateProps(
      props,
      ['classString', 'children'], // React特有のプロパティ
      ['id', 'role'] // DOM要素に直接渡すプロパティ
    );
    
    // 各種プロパティの取得
    const { classString = '', children = 'Special Example' } = reactProps;
    const { id, role } = domProps;
    
    // ReactElementを生成
    const reactElement = (
      <div 
        className={`${classString} special-style`}
        id={id}
        role={role}
        {...commonProps}
      >
        {children}
      </div>
    );
    
    // HTMLは自動生成される
    return createHandlerResult(reactElement);
  },
  // 他のバリアント...
};

// 4. プレビュー用サンプル (オプション)
export const samples = {
  default: 'デフォルト表示',
  special: '特別表示',
};

// 5. デフォルトエクスポート (必須)
export default {
  metadata,
  render, // 基本レンダラー (なければ undefined でも可)
  variants, // バリアント (なければ undefined でも可)
  samples, // サンプル (なければ undefined でも可)
};